{% extends 'base.html' %}
{% block content %}
<div class="row g-4">
  <div class="col-lg-4">
    <div class="card shadow-sm">
      <div class="card-header bg-white"><strong>Add Breakdown</strong></div>
      <div class="card-body">
        <form method="post">
          <div class="mb-3"><label class="form-label">Machine</label>
            <select class="form-select" name="machine_id" required>
              <option value="">Select machine</option>
              {% for row in machines %}<option value="{{ row.id }}">{{ row.machine_code }} / {{ row.machine_name }} / {{ row.line_name or '-' }}</option>{% endfor %}
            </select>
          </div>
          <div class="mb-3"><label class="form-label">Start Time</label><input class="form-control" type="datetime-local" name="start_time" required></div>
          <div class="mb-3"><label class="form-label">End Time</label><input class="form-control" type="datetime-local" name="end_time"></div>
          <div class="mb-3"><label class="form-label">Technician</label><input class="form-control" name="technician_name"></div>
          <div class="mb-3"><label class="form-label">Related Batch (optional)</label>
            <select class="form-select" name="batch_id">
              <option value="">Not linked</option>
              {% for b in batches %}<option value="{{ b.id }}">{{ b.batch_no }}</option>{% endfor %}
            </select>
          </div>
          <div class="mb-3"><label class="form-label">Reason</label><input class="form-control" name="reason" required></div>
          <div class="mb-3"><label class="form-label">Remarks</label><textarea class="form-control" name="remarks" rows="3"></textarea></div>
          <button class="btn btn-dark w-100">Save Breakdown</button>
        </form>
      </div>
    </div>
  </div>
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-header bg-white"><strong>Breakdown Records</strong></div>
      <div class="card-body table-responsive">
        <table class="table table-striped table-sm align-middle">
          <thead><tr><th>Machine</th><th>Section</th><th>Status</th><th>Start</th><th>End</th><th>Batch</th><th>Reason</th><th>Tech</th></tr></thead>
          <tbody>
            {% for row in rows %}
            <tr>
              <td>{{ row.machine_code or row.machine_name }}</td>
              <td>{{ row.section_name }}</td>
              <td><span class="badge text-bg-{{ 'danger' if row.status == 'OPEN' else 'secondary' }}">{{ row.status }}</span></td>
              <td>{{ row.start_time }}</td>
              <td>{{ row.end_time or '-' }}</td>
              <td>{{ row.batch_no or '-' }}</td>
              <td>{{ row.reason }}</td>
              <td>{{ row.technician_name or '-' }}</td>
            </tr>
            {% else %}
            <tr><td colspan="8" class="text-center text-muted">No breakdown records yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
