{% extends 'base.html' %}
{% block content %}
<div class="row g-4">
  <div class="col-lg-4">
    <div class="card shadow-sm">
      <div class="card-header bg-white"><strong>Create Customer File</strong></div>
      <div class="card-body">
        <form method="post">
          <div class="mb-3"><label class="form-label">Customer File No</label><input class="form-control" name="file_no" placeholder="CF-0003" required></div>
          <div class="mb-3"><label class="form-label">Customer</label>
            <select class="form-select" name="customer_id" required>
              <option value="">Select customer</option>
              {% for row in customers %}<option value="{{ row.id }}">{{ row.code }} / {{ row.name }}</option>{% endfor %}
            </select>
          </div>
          <div class="row g-2">
            <div class="col-md-6"><label class="form-label">Order Date</label><input class="form-control" type="date" name="order_date" required></div>
            <div class="col-md-6"><label class="form-label">Due Date</label><input class="form-control" type="date" name="due_date"></div>
          </div>
          <div class="mt-3"><label class="form-label">PO No</label><input class="form-control" name="po_no" placeholder="PO-12345"></div>
          <div class="mt-3"><label class="form-label">Remarks</label><textarea class="form-control" name="remarks" rows="3" placeholder="Mixed order from customer"></textarea></div>
          <button class="btn btn-dark w-100 mt-3">Create Customer File</button>
        </form>
      </div>
    </div>
  </div>
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-header bg-white"><strong>Customer Files</strong></div>
      <div class="card-body table-responsive">
        <table class="table table-striped table-sm align-middle">
          <thead><tr><th>File No</th><th>Customer</th><th>Order Date</th><th>Due Date</th><th>Items</th><th>Total KG</th><th>Pending Job Lines</th><th>Action</th></tr></thead>
          <tbody>
            {% for row in rows %}
            <tr>
              <td>
                <div class="fw-semibold">{{ row.file_no }}</div>
                <div class="small text-muted">{{ row.po_no or '-' }}</div>
              </td>
              <td>{{ row.customer_name }}</td>
              <td>{{ row.order_date }}</td>
              <td>{{ row.due_date or '-' }}</td>
              <td>{{ row.item_count }}</td>
              <td>{{ row.total_qty_kg }}</td>
              <td>{{ row.pending_job_lines or 0 }}</td>
              <td><a class="btn btn-sm btn-dark" href="{{ url_for('customer_file_detail', file_id=row.id) }}">Open</a></td>
            </tr>
            {% else %}
            <tr><td colspan="8" class="text-center text-muted">No customer files yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
