{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
  <div>
    <h1 class="h3 mb-1">Customer Item Tracker</h1>
    <p class="text-muted mb-0">Trace each bought item from customer file to current production stage.</p>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-3"><div class="card shadow-sm"><div class="card-body"><div class="text-muted small">Total Items</div><div class="display-6 fw-semibold">{{ summary.total }}</div></div></div></div>
  <div class="col-md-3"><div class="card shadow-sm"><div class="card-body"><div class="text-muted small">In Production</div><div class="display-6 fw-semibold">{{ summary.in_production }}</div></div></div></div>
  <div class="col-md-3"><div class="card shadow-sm"><div class="card-body"><div class="text-muted small">Ready For Production</div><div class="display-6 fw-semibold">{{ summary.ready }}</div></div></div></div>
  <div class="col-md-3"><div class="card shadow-sm"><div class="card-body"><div class="text-muted small">Risk Items</div><div class="display-6 fw-semibold">{{ summary.risk }}</div></div></div></div>
</div>

<div class="card shadow-sm">
  <div class="card-header bg-white"><strong>Current status by item</strong></div>
  <div class="card-body table-responsive">
    <table class="table table-striped table-sm align-middle">
      <thead>
        <tr>
          <th>File</th>
          <th>Line</th>
          <th>Customer</th>
          <th>Product</th>
          <th>Qty KG</th>
          <th>Current</th>
          <th>Stage</th>
          <th>Job</th>
          <th>Batch</th>
          <th>Machine</th>
          <th>Planner Ready</th>
          <th>Remain Hrs</th>
          <th>Due Date</th>
          <th>Risk</th>
          <th>Last Update</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
        <tr>
          <td><a href="{{ url_for('customer_file_detail', file_id=row.customer_file_id) }}">{{ row.file_no }}</a></td>
          <td>{{ row.line_no }}</td>
          <td>{{ row.customer_code }} / {{ row.customer_name }}</td>
          <td>{{ row.sku }} / {{ row.product_name }}</td>
          <td>{{ row.ordered_qty_kg }}</td>
          <td>
            <span class="badge text-bg-{% if row.status == 'COMPLETED' %}success{% elif row.status == 'IN_PRODUCTION' %}primary{% elif row.status == 'HOLD' %}danger{% elif row.status == 'READY_FOR_PRODUCTION' %}warning{% else %}secondary{% endif %}">
              {{ row.status }}
            </span>
          </td>
          <td>{{ row.current_stage }}</td>
          <td>{{ row.job_no or '-' }}</td>
          <td>{{ row.batch_no or '-' }}</td>
          <td>{{ row.latest_machine or '-' }}</td>
          <td>{{ row.ready_at or '-' }}</td>
          <td>{{ row.remaining_hours if row.remaining_hours is not none else '-' }}</td>
          <td>{{ row.due_date or '-' }}</td>
          <td><span class="badge text-bg-{% if row.risk == 'RISK' %}danger{% elif row.risk == 'TIGHT' %}warning{% else %}secondary{% endif %}">{{ row.risk }}</span></td>
          <td>{{ row.last_update or '-' }}</td>
          <td><a class="btn btn-sm btn-outline-dark" href="{{ url_for('item_tracker_detail', item_id=row.id) }}">Open</a></td>
        </tr>
        {% else %}
        <tr><td colspan="16" class="text-center text-muted">No customer items found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
